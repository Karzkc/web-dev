var D=(i,e)=>(e=Symbol[i])?e:Symbol.for("Symbol."+i),P=i=>{throw TypeError(i)};var b=(i,e,s)=>{if(e!=null){typeof e!="object"&&typeof e!="function"&&P("Object expected");var t,c;s&&(t=e[D("asyncDispose")]),t===void 0&&(t=e[D("dispose")],s&&(c=t)),typeof t!="function"&&P("Object not disposable"),c&&(t=function(){try{c.call(this)}catch(o){return Promise.reject(o)}}),i.push([s,t,e])}else s&&i.push([s]);return e},w=(i,e,s)=>{var t=typeof SuppressedError=="function"?SuppressedError:function(a,u,r,n){return n=Error(r),n.name="SuppressedError",n.error=a,n.suppressed=u,n},c=a=>e=s?new t(a,e,"An error was suppressed during disposal"):(s=!0,a),o=a=>{for(;a=i.pop();)try{var u=a[1]&&a[1].call(a[2]);if(a[0])return Promise.resolve(u).then(o,r=>(c(r),o()))}catch(r){c(r)}if(s)throw e};return o()};import{compile as F,env as U,Features as m,Instrumentation as B,normalizePath as x}from"@tailwindcss/node";import{clearRequireCache as V}from"@tailwindcss/node/require-cache";import{Scanner as A}from"@tailwindcss/oxide";import{Features as h,transform as G}from"lightningcss";import y from"node:fs/promises";import p from"node:path";var d=U.DEBUG,J=/[?&](?:worker|sharedworker|raw|url)\b/,L=/\?commonjs-proxy/,z=/[?&]index\=\d+\.css$/;function K(){let i=[],e=null,s=!1,t=!1,c=new R(o=>{let a=e.createResolver({...e.resolve,extensions:[".css"],mainFields:["style"],conditions:["style","development|production"],tryIndex:!1,preferRelative:!0});function u(l,f){return a(l,f,!0,s)}let r=e.createResolver(e.resolve);function n(l,f){return r(l,f,!0,s)}return new C(o,e.root,u,n)});return[{name:"@tailwindcss/vite:scan",enforce:"pre",configureServer(o){i.push(o)},async configResolved(o){e=o,t=e.build.cssMinify!==!1,s=e.build.ssr!==!1&&e.build.ssr!==void 0}},{name:"@tailwindcss/vite:generate:serve",apply:"serve",enforce:"pre",async transform(o,a,u){var f=[];try{if(!E(a))return;let r=b(f,new B);d&&r.start("[@tailwindcss/vite] Generate CSS (serve)");let n=c.get(a);let l=await n.generate(o,_=>this.addWatchFile(_),r);if(!l)return c.delete(a),o;d&&r.end("[@tailwindcss/vite] Generate CSS (serve)");return{code:l}}catch(g){var v=g,S=!0}finally{w(f,v,S)}}},{name:"@tailwindcss/vite:generate:build",apply:"build",enforce:"pre",async transform(o,a){var l=[];try{if(!E(a))return;let u=b(l,new B);d&&u.start("[@tailwindcss/vite] Generate CSS (build)");let r=c.get(a);let n=await r.generate(o,S=>this.addWatchFile(S),u);if(!n)return c.delete(a),o;d&&u.end("[@tailwindcss/vite] Generate CSS (build)");d&&u.start("[@tailwindcss/vite] Optimize CSS");n=T(n,{minify:t});d&&u.end("[@tailwindcss/vite] Optimize CSS");return{code:n}}catch(f){var g=f,v=!0}finally{w(l,g,v)}}}]}function O(i){let[e]=i.split("?",2);return p.extname(e).slice(1)}function E(i){return i.includes("/.vite/")?void 0:(O(i)==="css"||i.includes("&lang.css")||i.match(z))&&!J.test(i)&&!L.test(i)}function T(i,{file:e="input.css",minify:s=!1}={}){function t(c){return G({filename:e,code:c,minify:s,sourceMap:!1,drafts:{customMedia:!0},nonStandard:{deepSelectorCombinator:!0},include:h.Nesting,exclude:h.LogicalProperties|h.DirSelector|h.LightDark,targets:{safari:16<<16|1024,ios_saf:16<<16|1024,firefox:8388608,chrome:7274496},errorRecovery:!0}).code}return t(t(Buffer.from(i))).toString()}function M(i){return p.resolve(i.replace(/\?.*$/,""))}var R=class extends Map{constructor(s){super();this.factory=s}get(s){let t=super.get(s);return t===void 0&&(t=this.factory(s,this),this.set(s,t)),t}},C=class{constructor(e,s,t,c){this.id=e;this.base=s;this.customCssResolver=t;this.customJsResolver=c}compiler;scanner;candidates=new Set;buildDependencies=new Map;async generate(e,s,t){let c=this.requiresBuild(),o=M(this.id),a=p.dirname(p.resolve(o));if(!this.compiler||!this.scanner||await c){V(Array.from(this.buildDependencies.keys())),this.buildDependencies.clear(),this.addBuildDependency(M(o)),d&&t.start("Setup compiler");let r=[];this.compiler=await F(e,{base:a,shouldRewriteUrls:!0,onDependency:l=>{s(l),r.push(this.addBuildDependency(l))},customCssResolver:this.customCssResolver,customJsResolver:this.customJsResolver}),await Promise.all(r),d&&t.end("Setup compiler"),d&&t.start("Setup scanner");let n=(this.compiler.root==="none"?[]:this.compiler.root===null?[{base:this.base,pattern:"**/*"}]:[this.compiler.root]).concat(this.compiler.globs);this.scanner=new A({sources:n}),d&&t.end("Setup scanner")}if(!(this.compiler.features&(m.AtApply|m.JsPluginCompat|m.ThemeFunction|m.Utilities)))return!1;if(this.compiler.features&m.Utilities){d&&t.start("Scan for candidates");for(let r of this.scanner.scan())this.candidates.add(r);d&&t.end("Scan for candidates")}if(this.compiler.features&m.Utilities){for(let r of this.scanner.files)s(r);for(let r of this.scanner.globs){if(r.pattern[0]==="!")continue;let n=p.relative(this.base,r.base);n[0]!=="."&&(n="./"+n),n=x(n),s(p.posix.join(n,r.pattern));let l=this.compiler.root;if(l!=="none"&&l!==null){let f=x(p.resolve(l.base,l.pattern));if(!await y.stat(f).then(v=>v.isDirectory(),()=>!1))throw new Error(`The path given to \`source(\u2026)\` must be a directory but got \`source(${f})\` instead.`)}}}d&&t.start("Build CSS");let u=this.compiler.build([...this.candidates]);return d&&t.end("Build CSS"),u}async addBuildDependency(e){let s=await y.stat(e);this.buildDependencies.set(e,s.mtimeMs)}async requiresBuild(){for(let[e,s]of this.buildDependencies)if((await y.stat(e)).mtimeMs>s)return!0;return!1}};export{K as default};
